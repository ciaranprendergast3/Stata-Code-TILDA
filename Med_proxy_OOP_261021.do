**** Medication proxies *******


// local keeps everything in memory only til script ends

local cfmeds A02BA01 A02BA02 A02BB01 A02BC01 A02BC02 A02BC03 A02BC04 A02BC05 A02BX02 A02BX13 A06AB53 A06AC01 A06AC03 A06AC51 A06AD11 A06AD15 A06AD65 A09AA02 A11CC05 A11JC92 A12AX91 A12AX92 B01AB01 B01AB05 B01AB10 B01AB12 H02AA02 H02AB02 H02AB04 H02AB06 H02AB08 H02AB09 J01AA02 J01AA04 J01AA08 J01CA01 J01CA04 J01CA09 J01CE01 J01CE02 J01CF05 J01CR02 J01DB01 J01DC02 J01DC04 J01DD02 J01DD04 J01DD08 J01EA01 J01EE01 J01FA01 J01FA09 J01FA10 J01FF01 J01GB03 J01GB06 J01MA01 J01MA02 J01MA12 J01MA14 J01XA01 J01XA02 J01XB01 J01XC01 N02BE01 M01AE01 R03AC02 R03AC03 R03AC12 R03AC13 R03AC18 R03AC19 R03AK06 R03AK07 R03AK10 R03AK11 R03AK14 R03AL02 R03AL03 R03AL04 R03AL05 R03AL06 R03AL08 R03AL12 R03BB01 R03BB04 R03BB05 R03BB06 R03BB07 R05CB01 R05CB02 R05CB03 R05CB15 R05CB93 R05CB99 R03CC02 V07AB94 V07AB93 V07AY04 V07AY05 V07AY06 V07AY98 J01DF01 J01GB01 R05CB13 R07AX02 R07AX31 R07AX30 R07AX32




local diabetesmmeds A10AB01 A10AB04 A10AB05 A10AB06 A10AC01 A10AD01 A10AD05 A10AD30 A10AE01 A10AE04 A10AE05 A10AE06 A10AE56 A10BA02 A10BB09 A10BB12 A10BD05 A10BD07 A10BD08 A10BD10 A10BD11 A10BD15 A10BD16 A10BD19 A10BD20 A10BD24 A10BG03 A10BH01 A10BH02 A10BH03 A10BH05 A10BJ01 A10BJ02 A10BJ05 A10BJ06 A10BK01 A10BK02 A10BK03 A10BK04 A10BX02 A10BX03 B01AA03 B01AC04 B01AC06 B01AE07 B01AF01 B01AF02 B01AF03 C01DA02 C01DA14 C02AC01 C02CA01 C02CA02 C02CA04 C02DB02 C02DC01 C03AA01 C03AB01 C03BA11 C03CA01 C03CA02 C03DA01 C03DA04 C03EB01 C07AA05 C07AA07 C07AB02 C07AB03 C07AB07 C07AB08 C07AB12 C07AG01 C07AG02 C07BA06 C07BB12 C07CB03 C07FB03 C08CA01 C08CA02 C08CA05 C08CA06 C08CA13 C08DA01 C08DB01 C09AA01 C09AA02 C09AA03 C09AA04 C09AA05 C09AA06 C09AA07 C09AA10 C09AA15 C09BA01 C09BA02 C09BA03 C09BA04 C09BA05 C09BA06 C09BB02 C09BB04 C09BB05 C09BX01 C09BX02 C09CA01 C09CA02 C09CA03 C09CA04 C09CA06 C09CA07 C09CA08 C09CA09 C09DA01 C09DA02 C09DA03 C09DA04 C09DA06 C09DA07 C09DA08 C09DB01 C09DB02 C09DB04 C09DX01 C09DX03 C09XA02 C09XA52 C10AA01 C10AA03 C10AA04 C10AA05 C10AA07 C10AB04 C10AB05 C10AC01 C10AC04 C10AX09 C10BA02 C10BA05 C10BA06 C10BX06 H04AA01 N03AX12 N06AA09 V04BW95 V04BW96 V04CA91 V04CA92 V07AY01 V07AY02 V07AY03 V07AY08 V07AY58  

local epilepsymeds S01EC01 N03AF01 N05BA09 N03AE01 N03AX23 N05BA01 N03AF04 N03AD01 B03BB01 N03AX12 N03AX18 N03AX09 N03AX14 N05CD08 N03AF02 N03AX22 N03AA02 N03AB02 N03AX16 N03AA03 N03AX21 N03AF03 N03AG06 N03AX11 N03AG01 N03AG04 N03AX15 

local msmeds A06AB53 A06AC01 A06AC03 A06AC51 A06AD11 A06AD15 A06AD65 A11JC94 G04BD02 G04BD04 G04BD06 G04BD07 G04BD08 G04BD09 G04BD11 G04BD12 H02AA02 H02AB02 H02AB04 H02AB06 H02AB08 H02AB09 J01AA02 J01AA04 J01AA08 J01CA01 J01CA04 J01CA09 J01CE01 J01CE02 J01CF05 J01CR02 J01DB01 J01DC02 J01DC04 J01DD02 J01DD04 J01DD08 J01EA01 J01EE01 J01FA01 J01FA09 J01FA10 J01FF01 J01GB03 J01GB06 J01MA01 J01MA02 J01MA12 J01MA14 J01XA01 J01XA02 J01XB01 J01XC01 J01XE01 J01XX01 M01AB05 M01AB55 M01AC05 M01AC06 M01AE01 M01AE02 M01AE03 M01AE17 M01AE52 M01AG01 M01AH01 M01AH05 M01AX01 M02AA05 M02AA06 M02AA07 M02AA08 M02AA10 M02AA13 M02AA15 M02AA26 M02AB01 M03BX01 M03BX02 M03CA01 M05BA04 M05BA06 M05BA07 M05BB02 M05BB03 M05BB04 M05BX03 M05BX04 N01BB52 N02AA01 N02AA03 N02AA05 N02AA51 N02AA55 N02AB03 N02AE01 N02AJ01 N02AJ06 N02AJ13 N02AJ14 N02AX02 N02AX05 N02AX06 N02BA01 N02BA02 N02BA10 N02BE01 N02BE51 N03AX09 N03AX12 N03AX16 N05AA01 N05AA02 N05AB04 N05AD01 N05AE04 N05AF01 N05AF05 N05AH03 N05AH04 N05AH05 N05AL01 N05AL05 N05AN01 N05AX08 N05AX12 N05AX13 N05BA01 N05BA02 N05BA06 N05BA08 N05BA09 N05BA11 N05BA12 N05CD01 N05CD02 N05CD05 N05CD06 N05CD07 N05CD08 N05CF01 N05CF02 N05CM05 N06AA04 N06AA06 N06AA07 N06AA09 N06AA16 N06AB03 N06AB04 N06AB05 N06AB06 N06AB08 N06AB10 N06AF04 N06AG02 N06AX05 N06AX11 N06AX12 N06AX16 N06AX18 N06AX21 N06AX22 N07BB04 N07XX07 P01BA02 V07AB94 V07AN01 V07AN02 V07AN03 V07AN04 V07AN05 V07AN06 V07AN08 V07AN09 V07AN11 V07AN12 V07AN13 V07AN14 V07AN15 V07AN16 V07AN17 V07AN19 V07AN21 V07AN57 V07AN68 V07AY04 V07AY05 V07AY06 L03AB07 L03AB08 L03AX13 L04AA27 L04AA31 L03AB13 L04AX07 A07AA09 L01BB04 





local parkinsonsmeds A06AB53 A06AC01 A06AC03 A06AC51 A06AD11 A06AD15 A06AD65 G04BD02 G04BD04 G04BD06 G04BD07 G04BD08 G04BD09 G04BD11 G04BD12 N04AA02 N04AA04 N04AB02 N04BA02 N04BA03 N04BC01 N04BC04 N04BC05 N04BC06 N04BC09 N04BD01 N04BD02 N04BX01 N04BX02 N06AA04 N06AA06 N06AA07 N06AA09 N06AA16 N06AB03 N06AB04 N06AB05 N06AB06 N06AB08 N06AB10 N06AF04 N06AG02 N06AX05 N06AX11 N06AX12 N06AX16 N06AX18 N06AX21 N06AX22 


//this counts all the meds they have total



foreach cat in cfmeds diabetesmmeds epilepsymeds msmeds parkinsonsmeds  {
	gen MD`cat'= 0
	foreach atc in ``cat'' {
		forvalues k = 1/20 {
			replace MD`cat' = MD`cat' + 1  if strpos(MDatc`k',"`atc'")==1
		}
	}
	label variable MD`cat' "Number of `cat' medications reported by each respondent"
}





/// these are the proxy meds for identifying unsaid LTIs

local proxycf R05CB13 R07AX02 R07AX31 R07AX30 R07AX32

local proxydiabetes A10A A10B

local proxyepil N03AF01 N03AE01 N03AX23 N03AF04 N03AD01 N03AX18 N03AX09 N03AX14 N03AF02 N03AX22 N03AA02 N03AB02 N03AA03 N03AX21 N03AF03 N03AG06 N03AX11 N03AG01 N03AG04 N03AX15

local proxyms L03AB07 L03AB08 L03AX13 L04AA27 L04AA31 L03AB13 L04AX07 L01BB04 

local proxypark N04BA02 N04BA03 N04BC04 N04BC05 N04BC09 N04BD01 N04BD02 N04BX01 N04BX02 
 
// this should count how many of the proxies people have if any
 
foreach proxy in proxycf proxydiabetes proxyepil proxyms proxypark  {
	gen MD`proxy'= 0
	foreach atc in ``proxy'' {
		forvalues k = 1/20 {
			replace MD`proxy' = MD`proxy' + 1  if strpos(MDatc`k',"`atc'")==1
		}
	}
	label variable MD`proxy' "Number of `proxy' medications reported by each respondent"
}

* Change pregabalin/gabapentin back to epilepsy -1
* FM - moved this down as we want to exclude these from the proxies for epilepsy, but not the LTI meds count
forvalues k = 1/20 {
	replace MDproxyepil = MDproxyepil - 1  if strpos(MDatc`k',"N03")==1 & (MDatc`k'==		"N03AX16" | MDatc`k'=="N03AX12")
}

	///this should give value of 1 if the LTI is present
	
 gen cf_final= MDproxycf>=1
 gen diabetes_final=CHRdiabetes==1 | MDproxydiabetes>=1
 gen epilepsy_final=CHRepilepsy==1 | MDproxyepil>=1
 gen ms_final= MDproxyms>=1
 gen parkinsons_final=CHRparkinsonism==1 | MDproxypark>=1
 
 
 /// sets total meds number of medications to 0 if not an LTI person
 /// FM changed naming as previous code would have reset diabetesmeds=0 if ms_final!=1
 foreach fin in cf diabetes epilepsy ms parkinsons {
 replace `fin'meds = 0 if `fin'_final !=1
 }
}
 
 
 
 
 